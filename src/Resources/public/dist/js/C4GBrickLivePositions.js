function livePositions(l,p,e,t){function n(e){var t,n,r,o,i,s,a,u;if(!(e=JSON.parse(e.responseText)).error)for(i={internalProjection:l.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4326")},s=new OpenLayers.Format.GeoJSON(i).read(e),t=0;t<s.length;t+=1)if(o=s[t])for(a=!1,n=0;n<p.children.length;n+=1){for(r=0;r<p.children[n].features.length;r+=1)if(p.children[n].features[r]&&(u=p.children[n].features[r].data.popupInfo)&&(c=u.search('id="c4g_brick_popup_id"'))&&0<c&&(u=u.substr(c,50))&&(c=u.search('value="'))&&0<c&&(u=u.substr(c))&&(c=u.indexOf('="')+2,c=(u=u.substring(c)).indexOf('">'),(u=u.substring(0,c))&&u==o.data.id)){var c=p.children[n].features[r];c.lonlat.lon=o.geometry.x,c.lonlat.lat=o.geometry.y,o.data.popupInfo&&(c.attributes.popupInfo=c.data.popupInfo+o.data.popupInfo),c.geometry.move(o.geometry.x-c.geometry.x,o.geometry.y-c.geometry.y),p.children[n].redraw(),a=!0;break}if(a)break}d=window.setTimeout(function(){f()},1e4)}var d,r=(p=p).key,o=(l.events.register("changelayer",null,function(e){"visibility"===e.property&&e.layer.key==r&&(e.layer.visibility?f():window.clearTimeout(d))}),"src/con4gis/CoreBundle/src/Resources/api/index.php/"+e.type+"Service?method=getPositions"),f=function(){OpenLayers.Request.GET({url:o,callback:n})};p.visibility&&f()}var fnPushCallback=function(e){document.getElementById("c4g_push_message").value=""};function onPushMessage(e,t,n,r){var o=document.getElementById("c4g_push_message").value,e="/con4gis/"+e+"Service/push?method=pushMessage&conf="+r+"&device="+n+"&token="+t+"&content="+o;(r=new XMLHttpRequest).open("GET",e),r.setRequestHeader("push",o),r.send()}